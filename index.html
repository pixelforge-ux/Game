<!DOCTYPE html>
<html lang="fa">
<head>
<script src="https://developer.eitaa.com/eitaa-web-app.js"></script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¯ÙˆØ² </title>



<style>
:root{
  --bg1: #0f172a;
  --bg2: #071627;
  --accent1: #ff6f96;
  --accent2: #6a85ff;
  --neon: #00eaff;
  --glass-bg: rgba(255,255,255,0.06);
  --card-radius: 16px;
  --button-radius: 22px;
  --font-stack: Vazirmatn, system-ui, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;padding:0}
body{
  min-height:100vh;
  font-family:var(--font-stack);
  display:flex;
  align-items:flex-start;
  justify-content:center;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  color:#fff;
  padding:18px;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
.container{
  width:100%;
  max-width:980px;
}
h1{
  margin:10px 0 14px;
  font-size:26px;
  text-align:center;
  color:#fff;
  text-shadow:0 2px 8px rgba(0,0,0,0.4);
}
.card{
  width:100%;
  padding:18px;
  border-radius:var(--card-radius);
  background:var(--glass-bg);
  backdrop-filter: blur(12px) saturate(140%);
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
  margin-bottom:16px;
}
#menu,#settings,#game,#history{
  display:none;
  gap:12px;
  align-items:center;
}
button{
  cursor:pointer;
  border:0;
  padding:12px 18px;
  border-radius:var(--button-radius);
  font-weight:700;
  outline:none;
  position:relative;
  overflow:hidden;
  transition: transform .22s ease, box-shadow .22s ease, filter .22s;
  -webkit-tap-highlight-color: transparent;
}
.menu-buttons{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.menu-buttons button{
  background: linear-gradient(145deg,var(--accent1), #ff92c2);
  color:#fff;
  box-shadow: 0 10px 24px rgba(0,0,0,0.36), inset 0 -6px 16px rgba(255,255,255,0.12);
  font-size:1rem;
}
.menu-buttons button::before{
  content:"";
  position:absolute;
  left:-60%;
  top:-50%;
  width:180%;
  height:220%;
  background: linear-gradient(90deg, rgba(255,255,255,0.28), rgba(255,255,255,0));
  transform: rotate(25deg);
  opacity:0;
  filter: blur(14px);
  transition: transform .45s ease, opacity .45s ease;
}
.menu-buttons button:hover::before{
  opacity:1;
  transform: rotate(25deg) translateX(40%);
}
.menu-buttons button:hover{
  transform: translateY(-6px);
  filter: drop-shadow(0 0 16px rgba(255,90,140,0.6));
  animation: gradientShift 2.5s linear infinite;
}
.menu-buttons button:active{
  transform: scale(.94);
  box-shadow: 0 6px 14px rgba(0,0,0,0.36);
}
.settings-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
}
.settings-grid label{
  display:flex;
  flex-direction:column;
  color:#e6eef8;
  font-size:13px;
}
.settings-grid input[type=color], .settings-grid select{
  padding:8px;
  border-radius:8px;
  border:0;
}
#board{
  display:grid;
  gap:12px;
  margin-top:16px;
  justify-content:center;
  align-items:center;
  transition: all .35s ease;
}
.cell{
  background: rgba(255,255,255,0.96);
  color:#111;
  height:88px;
  width:88px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:12px;
  font-weight:900;
  font-size:3.6rem;
  transition: transform .25s, box-shadow .25s;
  user-select:none;
  -webkit-user-select:none;
  position:relative;
}
.cell:hover{ transform: translateY(-6px); box-shadow:0 14px 32px rgba(0,0,0,0.25); }
#status{ margin-top:12px; font-size:18px; color:#fff; text-shadow:0 1px 2px rgba(0,0,0,0.35) }
#scoreboard{ margin-top:8px; font-weight:800; color:#fff }
#line{ position:absolute; height:6px; background:gold; display:none; z-index:3; border-radius:4px; transform-origin:left center; transition: all .5s ease; }
#historyList{ max-height:220px; overflow:auto; padding:0; margin-top:8px; }
#historyList li{ list-style:none; background: rgba(255,255,255,0.04); padding:8px; border-radius:8px; margin-bottom:6px; color:#eaf2ff }
.theme-classic{ background: linear-gradient(135deg,#ff9a9e,#fad0c4) }
.theme-dark{ background: linear-gradient(135deg,#232526,#414345) }
.theme-neon{ background: linear-gradient(135deg,#00f260,#0575e6) }
.theme-cyber{ background: linear-gradient(135deg,#00f0ff,#7b00ff) }
.theme-cyber .cell{
  background: rgba(0,0,0,0.6);
  border:1px solid rgba(0,255,255,0.12);
  box-shadow:0 0 14px var(--neon), inset 0 0 8px rgba(0,255,255,0.06);
  color: var(--neon);
}
.theme-cyber button{
  background: rgba(0,0,0,0.45);
  border:1px solid rgba(0,255,255,0.5);
  box-shadow: 0 0 16px var(--neon);
}
.theme-cyberglass{
  background: linear-gradient(135deg, rgba(0,255,255,0.08), rgba(0,0,80,0.28));
  backdrop-filter: blur(18px) saturate(160%);
}
.theme-cyberglass .cell{
  background: rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.12);
  box-shadow: 0 6px 18px rgba(0,255,255,0.06), inset 0 0 10px rgba(255,255,255,0.03);
}
.ripple{
  position:absolute;
  width:12px;
  height:12px;
  background: rgba(255,255,255,0.75);
  border-radius:50%;
  transform: translate(-50%, -50%) scale(0);
  animation: rippleAnim .6s ease-out forwards;
  pointer-events:none;
}
@keyframes rippleAnim{ to { transform: translate(-50%, -50%) scale(12); opacity:0 } }
.spinCell{ animation: spinClick .35s ease forwards; }
@keyframes spinClick{ from { transform: rotate(0) scale(1) } to { transform: rotate(360deg) scale(1.15) } }
.winShake{ animation: winShake .5s ease; }
@keyframes winShake{
  0%,100%{ transform: translate(0) }
  20%{ transform: translate(-8px,0) }
  40%{ transform: translate(8px,0) }
  60%{ transform: translate(-6px,0) }
  80%{ transform: translate(6px,0) }
}
.burst{
  position:absolute;
  width:20px;height:20px;border-radius:50%;
  background: radial-gradient(circle, rgba(255,255,255,1), rgba(255,255,255,0));
  animation: burstAnim .6s ease-out forwards;
  pointer-events:none;
}
@keyframes burstAnim{ 0%{ transform: translate(-50%, -50%) scale(.2); opacity:1 } 100%{ transform: translate(-50%, -50%) scale(8); opacity:0 } }
.fireWin{ animation: fireFX .8s ease-in-out; }
@keyframes fireFX{ 0%{ filter: drop-shadow(0 0 0px orange) } 50%{ filter: drop-shadow(0 0 22px red) } 100%{ filter: drop-shadow(0 0 0px orange) } }
.waveFX{ animation: waveScreen 6s ease-in-out infinite; }
@keyframes waveScreen{ 0%{ transform: scale(1) } 50%{ transform: scale(1.01) } 100%{ transform: scale(1) } }
@keyframes gradientShift{ 0%{ filter: hue-rotate(0deg) } 100%{ filter: hue-rotate(360deg) } }
.turnPulse{ animation: pulseTurn 1s ease-in-out infinite; }
@keyframes pulseTurn{ 0%{ transform: scale(1); filter: drop-shadow(0 0 0px #fff) } 50%{ transform: scale(1.12); filter: drop-shadow(0 0 18px #fff) } 100%{ transform: scale(1); filter: drop-shadow(0 0 0px #fff) } }
@keyframes fadeSlide{ from{ opacity:0; transform: translateY(20px) } to{ opacity:1; transform: translateY(0) } }
@keyframes fadeSlideOut{ from{ opacity:1; transform: translateY(0) } to{ opacity:0; transform: translateY(20px) } }
@media (max-width: 520px){
  .container{ padding:8px }
  .menu-buttons button{ font-size:15px; padding:12px; border-radius:14px }
  .cell{ width:72px; height:72px; font-size:2.6rem; border-radius:10px }
  #settings{ width:92% }
}
.hidden{ display:none !important }
</style>
</head>
<body>
<div class="container">
  <h1>Ø¯ÙˆØ²</h1>

  <div id="menu" class="card" style="display:flex;flex-direction:column;animation:fadeSlide .45s ease;">
    <div class="menu-buttons">
      <button id="btnHuman">Ø¨Ø§Ø²ÛŒ Ø¯Ùˆ Ù†ÙØ±Ù‡</button>
      <button id="btnAI">Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø±Ø¨Ø§Øª</button>
      <button id="btnSettings">Ø´Ø®ØµÛŒ Ø³Ø§Ø²ÛŒ </button>
      <button id="btnHistory">ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
    </div>
  </div>

  <div id="settings" class="card" style="display:flex;flex-direction:column" >
    <div class="settings-grid">
      <label>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¬Ø¯ÙˆÙ„
        <select id="boardSize">
          <option value="3">Û³Ã—Û³</option>
          <option value="4">Û´Ã—Û´</option>
          <option value="5">ÛµÃ—Ûµ</option>
        </select>
      </label>

      <label>Ø³Ø®ØªÛŒ Ø±Ø¨Ø§Øª
        <select id="difficulty">
          <option value="easy">Ø¢Ø³Ø§Ù†</option>
          <option value="medium">Ù…ØªÙˆØ³Ø·</option>
          <option value="hard">Ø³Ø®Øª</option>
        </select>
      </label>

      <label>Ø±Ù†Ú¯ X<input type="color" id="colorX"></label>
      <label>Ø±Ù†Ú¯ O<input type="color" id="colorO"></label>

      <label>Ù¾ÙˆØ³ØªÙ‡
        <select id="theme">
          <option value="classic">Ú©Ù„Ø§Ø³ÛŒÚ©</option>
          <option value="dark">ØªØ§Ø±ÛŒÚ©</option>
          <option value="neon">Ù†Ø¦ÙˆÙ†</option>
          <option value="cyber">Ù†Ø¦ÙˆÙ† Ø³Ø§ÛŒØ¨Ø±</option>
          <option value="cyberglass">CyberGlass</option>
        </select>
      </label>

      <label>Ù†Ù…Ø§ÛŒØ´
        <select id="symbolMode">
          <option value="classic">X/O</option>
          <option value="emoji">ğŸ¯/ğŸ®</option>
          <option value="emoji2">â¤ï¸/ğŸ’</option>
        </select>
      </label>
    </div>

    <label style="margin-top:10px">
      <input type="checkbox" id="musicToggle"> Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
    </label>

    <div style="display:flex;gap:12px;margin-top:12px">
      <button id="btnBack">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</button>
      <button id="btnApply">Ø§Ø¹Ù…Ø§Ù„ Ùˆ Ø´Ø±ÙˆØ¹</button>
    </div>
  </div>

  <div id="game" class="card" style="display:flex;flex-direction:column">
    <div id="boardWrapper" style="position:relative;display:flex;flex-direction:column;align-items:center">
      <div id="board"></div>
      <div id="line"></div>
    </div>
    <div id="status">ÙˆØ¶Ø¹ÛŒØª...</div>
    <div id="scoreboard">X: 0 | O: 0</div>

    <div style="display:flex; gap:14px; margin-top:16px;">
      <button id="btnMenu">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</button>
      <button id="btnReset">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¨Ø§Ø²ÛŒ</button>
      <button id="btnToggleMusic">Ù¾Ø®Ø´ Ù…ÙˆØ³ÛŒÙ‚ÛŒ</button>
    </div>
  </div>

  <div id="history" class="card" style="display:flex;flex-direction:column">
    <h3>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§</h3>
    <ul id="historyList"></ul>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="btnCloseHistory">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

</div>

<audio id="bgMusic" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>
<audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="winSound" src="https://actions.google.com/sounds/v1/cartoon/concussive_drum_hit.ogg"></audio>

<script>
var board = [];
var currentPlayer = 'X';
var gameOver = false;
var boardElement = null;
var playerColors = { X: '#ff3b3b', O: '#2b8cff' };
var gameMode = 'human';
var difficulty = 'easy';
var boardSize = 3;
var scores = { X: 0, O: 0 };
var symbolMode = 'classic';
var symbols = { X: 'X', O: 'O' };
function $(id){return document.getElementById(id)}
boardElement = $('board');
var statusEl = $('status');
var scoreboardEl = $('scoreboard');
var lineEl = $('line');
var bgMusic = $('bgMusic');
var clickSound = $('clickSound');
var winSound = $('winSound');
function setTheme(name){
  document.body.className = document.body.className.split(' ').filter(c=>!c.startsWith('theme-')).join(' ');
  if(name) document.body.classList.add('theme-' + name);
}
function saveSettings(){try{localStorage.setItem('colorX', playerColors.X);localStorage.setItem('colorO', playerColors.O);localStorage.setItem('theme', $('theme').value);localStorage.setItem('symbolMode', symbolMode)}catch(e){}}
function show(id){$(id).style.display='flex'}
function hide(id){$(id).style.display='none'}
function initUI(){
  $('btnHuman').addEventListener('click', function(){ startGame('human') });
  $('btnAI').addEventListener('click', function(){ startGame('ai') });
  $('btnSettings').addEventListener('click', function(){ hide('menu'); show('settings') });
  $('btnHistory').addEventListener('click', function(){ hide('menu'); show('history'); renderHistory() });
  $('btnBack').addEventListener('click', function(){ hide('settings'); show('menu') });
  $('btnApply').addEventListener('click', function(){ applySettings(); startGame(gameMode) });
  $('btnMenu').addEventListener('click', function(){ hide('game'); show('menu') });
  $('btnReset').addEventListener('click', function(){ resetGame() });
  $('btnToggleMusic').addEventListener('click', function(){ toggleMusic(true) });
  $('btnCloseHistory').addEventListener('click', function(){ hide('history'); show('menu') });
  var cx = $('colorX'), co = $('colorO');
  cx.value = playerColors.X; co.value = playerColors.O;
  cx.addEventListener('change', function(){ playerColors.X = cx.value; createBoard() });
  co.addEventListener('change', function(){ playerColors.O = co.value; createBoard() });
  $('boardSize').addEventListener('change', function(){ boardSize = parseInt(this.value) || 3 });
  $('difficulty').addEventListener('change', function(){ difficulty = this.value });
  $('theme').addEventListener('change', function(){
    var v = this.value;
    if(v === 'cyberglass') setTheme('cyberglass');
    else if(v === 'cyber') setTheme('cyber');
    else setTheme(v);
  });
  $('symbolMode').addEventListener('change', function(){
    symbolMode = this.value;
    if(symbolMode === 'classic') symbols = { X: 'X', O: 'O' }
    else if(symbolMode === 'emoji') symbols = { X: 'ğŸ¯', O: 'ğŸ®' }
    else if(symbolMode === 'emoji2') symbols = { X: 'â¤ï¸', O: 'ğŸ’' }
    createBoard();
  });
  var sx = localStorage.getItem('colorX'), so = localStorage.getItem('colorO');
  if(sx) playerColors.X = sx;
  if(so) playerColors.O = so;
  var th = localStorage.getItem('theme') || 'classic';
  if(th === 'cyberglass') setTheme('cyberglass'); else setTheme(th);
  var sm = localStorage.getItem('symbolMode') || 'classic';
  symbolMode = sm;
  if(symbolMode === 'classic') symbols = { X: 'X', O: 'O' };
  else if(symbolMode === 'emoji') symbols = { X: 'ğŸ¯', O: 'ğŸ®' };
  else if(symbolMode === 'emoji2') symbols = { X: 'â¤ï¸', O: 'ğŸ’' };
  var musicOn = (localStorage.getItem('musicOn') === 'true');
  $('musicToggle') && ($('musicToggle').checked = musicOn);
  hide('menu'); hide('settings'); hide('game'); hide('history'); show('menu');
}
function startGame(mode){ gameMode = mode || gameMode; boardSize = parseInt($('boardSize').value) || 3; board = Array(boardSize * boardSize).fill(''); currentPlayer = 'X'; gameOver = false; createBoard(); hide('menu'); hide('settings'); show('game'); updateStatus(); setTimeout(function(){ boardElement.classList.add('show') }, 60); }
function resetGame(){ startGame(gameMode) }
function createBoard(){
  boardElement.innerHTML = '';
  var size = Math.max(3, boardSize);
  var cellPx = Math.min(88, Math.floor(window.innerWidth / boardSize) - 6);
  if(window.innerWidth < 520) cellPx = 72;
  boardElement.style.gridTemplateColumns = 'repeat(' + size + ',' + cellPx + 'px)';
  boardElement.style.gridTemplateRows = 'repeat(' + size + ',' + cellPx + 'px)';
  for(var i=0;i<board.length;i++){
    var d = document.createElement('div');
    d.className = 'cell';
    d.dataset.index = i;
    d.textContent = board[i] ? symbols[ board[i] ] : '';
    if(board[i]) d.style.color = playerColors[ board[i] ];
    (function(idx, el){
      el.addEventListener('click', function(e){
        handleCellClick(idx, e, el);
      });
    })(i, d);
    boardElement.appendChild(d);
  }
}
function handleCellClick(index, event, el){
    if(el.classList.contains('locked')) return;
    el.classList.add('locked');
    setTimeout(()=>el.classList.remove('locked'),350);
  try{ clickSound.currentTime = 0; clickSound.play(); } catch(e){}
  makeRipple(event, el);
  el.classList.add('spinCell');
  setTimeout(function(){ el.classList.remove('spinCell') }, 400);
  if(board[index] || gameOver) return;
  board[index] = currentPlayer;
  createBoard();
  if(checkWinner(currentPlayer)){
    gameOver = true;
    scores[currentPlayer] = (scores[currentPlayer]||0) + 1;
    updateScoreboard();
    statusEl.innerText = 'Ø¨Ø§Ø²ÛŒÚ©Ù† ' + currentPlayer + ' Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯';
    animateWinningCells(currentPlayer);
    addHistory('Ø¨Ø§Ø²ÛŒÚ©Ù† ' + currentPlayer + ' Ø¨Ø±Ø¯');
    try{ winSound.currentTime = 0; winSound.play(); }catch(e){}
    return;
  }
  if(board.indexOf('') === -1){
    gameOver = true;
    statusEl.innerText = 'Ø¨Ø§Ø²ÛŒ Ù…Ø³Ø§ÙˆÛŒ Ø´Ø¯';
    addHistory('Ø¨Ø§Ø²ÛŒ Ù…Ø³Ø§ÙˆÛŒ Ø´Ø¯');
    return;
  }
  currentPlayer = (currentPlayer === 'X') ? 'O' : 'X';
  updateStatus();
  if(gameMode === 'ai' && currentPlayer === 'O' && !gameOver){
    setTimeout(aiMove, 380);
  }
}
function makeRipple(event, target){
  var r = document.createElement('span');
  r.className = 'ripple';
  var rect = target.getBoundingClientRect();
  var x = (event.clientX || 0) - rect.left;
  var y = (event.clientY || 0) - rect.top;
  r.style.left = (x) + 'px';
  r.style.top = (y) + 'px';
  target.appendChild(r);
  setTimeout(function(){ r.remove() }, 700);
}
function checkWinner(player){
  var winLength = (boardSize === 3) ? 3 : ((boardSize === 4) ? 4 : 5);
  var lines = [];
  for(var r=0;r<boardSize;r++){
    for(var c=0;c<=boardSize-winLength;c++){
      var line = [];
      for(var k=0;k<winLength;k++) line.push(r*boardSize + c + k);
      lines.push(line);
    }
  }
  for(var c=0;c<boardSize;c++){
    for(var r=0;r<=boardSize-winLength;r++){
      var line = [];
      for(var k=0;k<winLength;k++) line.push((r+k)*boardSize + c);
      lines.push(line);
    }
  }
  for(var r=0;r<=boardSize-winLength;r++){
    for(var c=0;c<=boardSize-winLength;c++){
      var line = [];
      for(var k=0;k<winLength;k++) line.push((r+k)*boardSize + (c+k));
      lines.push(line);
    }
  }
  for(var r=0;r<=boardSize-winLength;r++){
    for(var c=winLength-1;c<boardSize;c++){
      var line = [];
      for(var k=0;k<winLength;k++) line.push((r+k)*boardSize + (c-k));
      lines.push(line);
    }
  }
  return lines.some(function(line){
    return line.every(function(i){ return board[i] === player });
  });
}
function animateWinningCells(player){
  var winLen = (boardSize === 3) ? 3 : ((boardSize === 4) ? 4 : 5);
  var lines = [];
  for(var r=0;r<boardSize;r++){
    for(var c=0;c<=boardSize-winLen;c++){
      var line=[]; for(var k=0;k<winLen;k++) line.push(r*boardSize + c + k); lines.push(line);
    }
  }
  for(var c=0;c<boardSize;c++){
    for(var r=0;r<=boardSize-winLen;r++){
      var line=[]; for(var k=0;k<winLen;k++) line.push((r+k)*boardSize + c); lines.push(line);
    }
  }
  for(var r=0;r<=boardSize-winLen;r++){
    for(var c=0;c<=boardSize-winLen;c++){
      var line=[]; for(var k=0;k<winLen;k++) line.push((r+k)*boardSize + (c+k)); lines.push(line);
    }
  }
  for(var r=0;r<=boardSize-winLen;r++){
    for(var c=winLen-1;c<boardSize;c++){
      var line=[]; for(var k=0;k<winLen;k++) line.push((r+k)*boardSize + (c-k)); lines.push(line);
    }
  }
  var pattern = lines.find(function(l){
    return l.every(function(i){ return board[i] === player });
  });
  if(pattern){
    pattern.forEach(function(i){
      var cel = boardElement.children[i];
      if(cel){
        cel.classList.add('winShake');
        cel.classList.add('fireWin');
        setTimeout(function(){ cel.classList.remove('winShake'); }, 900);
      }
    });
    try{
      var first = boardElement.children[pattern[0]].getBoundingClientRect();
      var last  = boardElement.children[pattern[pattern.length-1]].getBoundingClientRect();
      var brect = boardElement.getBoundingClientRect();
      var width = Math.hypot(last.x - first.x, last.y - first.y) + 50;
      lineEl.style.display = 'block';
      lineEl.style.width = width + 'px';
      lineEl.style.left = (first.x - brect.x + (first.width/2)) + 'px';
      lineEl.style.top  = (first.y - brect.y + (first.height/2)) + 'px';
      var angle = Math.atan2(last.y - first.y, last.x - first.x) * (180/Math.PI);
      lineEl.style.transform = 'rotate(' + angle + 'deg)';
      setTimeout(function(){ lineEl.style.display = 'none'; }, 1600);
    }catch(e){}
    var midIdx = pattern[Math.floor(pattern.length/2)];
    var midRect = boardElement.children[midIdx].getBoundingClientRect();
    var b = document.createElement('div'); b.className = 'burst';
    b.style.left = (midRect.left + midRect.width/2) + 'px';
    b.style.top  = (midRect.top  + midRect.height/2) + 'px';
    document.body.appendChild(b);
    setTimeout(function(){ b.remove(); }, 800);
    document.body.classList.add('waveFX');
    setTimeout(function(){ document.body.classList.remove('waveFX'); }, 1200);
  }
}
function updateStatus(){
  if(gameOver) return;
  statusEl.innerHTML = 'Ù†ÙˆØ¨Øª Ø¨Ø§Ø²ÛŒÚ©Ù† <span id="turnMark">' + symbols[currentPlayer] + '</span>';
  var el = $('turnMark');
  if(el) el.classList.add('turnPulse');
}
function updateScoreboard(){
  scoreboardEl.innerText = 'X: ' + (scores.X||0) + ' | O: ' + (scores.O||0);
}
function addHistory(text){
  try{
    var h = JSON.parse(localStorage.getItem('history') || '[]');
    var dt = new Date();
    h.unshift(dt.toLocaleDateString() + ' ' + dt.toLocaleTimeString() + ': ' + text);
    if(h.length > 50) h.pop();
    localStorage.setItem('history', JSON.stringify(h));
  }catch(e){}
}
function renderHistory(){
  var list = $('historyList'); list.innerHTML = '';
  var h = JSON.parse(localStorage.getItem('history') || '[]');
  h.forEach(function(it){
    var li = document.createElement('li'); li.innerText = it; list.appendChild(li);
  });
}
function applySettings(){
  playerColors.X = $('colorX').value || playerColors.X;
  playerColors.O = $('colorO').value || playerColors.O;
  symbolMode = $('symbolMode').value || symbolMode;
  if(symbolMode === 'classic') symbols = { X: 'X', O: 'O' };
  else if(symbolMode === 'emoji') symbols = { X: 'ğŸ¯', O: 'ğŸ®' };
  else if(symbolMode === 'emoji2') symbols = { X: 'â¤ï¸', O: 'ğŸ’' };
  var th = $('theme').value;
  if(th === 'cyberglass') setTheme('cyberglass');
  else if(th === 'cyber') setTheme('cyber');
  else setTheme(th);
  saveSettings();
}
function toggleMusic(forceUser){
  try{
    if(bgMusic.paused){
      bgMusic.currentTime = 0;
      bgMusic.play();
      $('btnToggleMusic').innerText = 'Ù¾Ø§ÛŒØ§Ù† Ù…ÙˆØ³ÛŒÙ‚ÛŒ';
      localStorage.setItem('musicOn','true');
      $('musicToggle') && ($('musicToggle').checked = true);
    } else {
      bgMusic.pause();
      $('btnToggleMusic').innerText = 'Ù¾Ø®Ø´ Ù…ÙˆØ³ÛŒÙ‚ÛŒ';
      localStorage.setItem('musicOn','false');
      $('musicToggle') && ($('musicToggle').checked = false);
    }
  }catch(e){}
}
document.addEventListener('click', function(e){
  var t = e.target;
  if(t && t.tagName !== 'BUTTON'){
    var pb = t.closest && t.closest('button');
    if(pb) t = pb;
  }
  if(t && t.tagName === 'BUTTON'){
    var rect = t.getBoundingClientRect();
    var r = document.createElement('span');
    r.className = 'ripple';
    var x = (e.clientX || 0) - rect.left;
    var y = (e.clientY || 0) - rect.top;
    r.style.left = x + 'px';
    r.style.top = y + 'px';
    t.appendChild(r);
    setTimeout(function(){ r.remove() }, 700);
    t.style.transform = 'scale(.98)';
    setTimeout(function(){ t.style.transform = 'scale(1)' }, 160);
    try{
      if( localStorage.getItem('musicOn') === 'true' && bgMusic.paused ){
        bgMusic.play().catch(function(){});
      }
    }catch(e){}
  }
});
boardElement.addEventListener('click', function(e){
  if(!e.target.classList || !e.target.classList.contains('cell')) return;
  var c = e.target;
  var rect = c.getBoundingClientRect();
  var b = document.createElement('div'); b.className = 'burst';
  b.style.left = (rect.left + rect.width/2) + 'px';
  b.style.top  = (rect.top  + rect.height/2) + 'px';
  document.body.appendChild(b);
  setTimeout(function(){ b.remove() }, 700);
});
function aiMove(){
  var empty = board.map(function(v,i){ return v === '' ? i : null }).filter(function(v){ return v !== null });
  if(empty.length === 0) return;
  var move;
  if(difficulty === 'easy'){
    move = empty[Math.floor(Math.random() * empty.length)];
  } else if(difficulty === 'medium'){
    move = mediumAI(empty);
  } else {
    move = hardAI();
  }
  setTimeout(function(){ 
    var fake = { clientX: 44, clientY: 44 };
    handleCellClick(move, fake, boardElement.children[move]);
  }, 420);
}
function mediumAI(empty){
  for(var idx=0; idx<empty.length; idx++){
    var i = empty[idx];
    board[i] = currentPlayer;
    if(checkWinner(currentPlayer)){ board[i] = ''; return i }
    board[i] = (currentPlayer === 'X') ? 'O' : 'X';
    if(checkWinner((currentPlayer === 'X') ? 'O' : 'X')){ board[i] = ''; return i }
    board[i] = '';
  }
  return empty[Math.floor(Math.random() * empty.length)];
}
function hardAI(){
  var bestScore = -Infinity, move = -1;
  for(var i=0;i<board.length;i++){
    if(board[i] === ''){
      board[i] = 'O';
      var score = minimax(board, 0, false);
      board[i] = '';
      if(score > bestScore){ bestScore = score; move = i; }
    }
  }
  return move;
}
function minimax(nb, depth, isMaximizing){
  if(checkWinner('O')) return 10 - depth;
  if(checkWinner('X')) return depth - 10;
  if(nb.indexOf('') === -1) return 0;
  if(isMaximizing){
    var best = -Infinity;
    for(var i=0;i<nb.length;i++){
      if(nb[i] === ''){
        nb[i] = 'O';
        var s = minimax(nb, depth+1, false);
        nb[i] = '';
        best = Math.max(s, best);
      }
    }
    return best;
  } else {
    var best = Infinity;
    for(var i=0;i<nb.length;i++){
      if(nb[i] === ''){
        nb[i] = 'X';
        var s = minimax(nb, depth+1, true);
        nb[i] = '';
        best = Math.min(s, best);
      }
    }
    return best;
  }
}
window.addEventListener('load', function(){
  initUI();
  try{
    if(localStorage.getItem('colorX')) $('colorX').value = localStorage.getItem('colorX');
    if(localStorage.getItem('colorO')) $('colorO').value = localStorage.getItem('colorO');
  }catch(e){}
  show('menu');
});
window.addEventListener('keydown', function(e){
  if(e.key === 'Escape'){
    if(getComputedStyle($('game')).display !== 'none'){ hide('game'); show('menu') }
  }
});
</script>

<!-- filler comments for length -->
<!-- filler 1 --><!-- filler 2 --><!-- filler 3 --><!-- filler 4 --><!-- filler 5 --><!-- filler 6 --><!-- filler 7 --><!-- filler 8 --><!-- filler 9 --><!-- filler 10 -->
	<style>
#gameFooter {
  position: fixed;
  bottom: 4px;
  left: 0;
  width: 100%;
  text-align: center;
  font-family: 'Vazirmatn', sans-serif;
  font-size: 14px;
  pointer-events: none;
  z-index: 9999;
  text-shadow: 0 0 6px currentColor, 0 0 12px currentColor, 0 0 18px currentColor;
  animation: neonGlow 2.5s ease-in-out infinite alternate, flicker 1.8s linear infinite;
}
@keyframes neonGlow {
  0% { text-shadow: 0 0 6px currentColor, 0 0 12px currentColor, 0 0 18px currentColor; }
  50% { text-shadow: 0 0 12px currentColor, 0 0 24px currentColor, 0 0 36px currentColor; }
  100% { text-shadow: 0 0 6px currentColor, 0 0 12px currentColor, 0 0 18px currentColor; }
}
@keyframes flicker {
  0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
  20%, 22%, 24%, 55% { opacity: 0.6; }
}
</style>

<footer id="gameFooter">Ú©Ø§Ø±ÛŒ Ø§Ø² Ø³ÛŒØ¯ Ø¢Ø±ÙˆÛŒÙ† Ù…ÙˆØ³ÙˆÛŒ</footer>

<script>
function updateFooterTheme() {
  const footer = document.getElementById('gameFooter');
  const bodyClass = document.body.className;

  let color = '#333'; // Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø±ÙˆØ´Ù† Ø¨Ø±Ø§ÛŒ ØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ú©
  if(bodyClass.includes('theme-dark')) color = '#fff';
  else if(bodyClass.includes('theme-neon')) color = '#0ff';
  else if(bodyClass.includes('theme-cyber')) color = '#0ff';
  else if(bodyClass.includes('theme-cyberglass')) color = '#0ff';
  else if(bodyClass.includes('theme-classic')) color = '#ff3b3b';

  footer.style.color = color;
}

// Ù‡Ù†Ú¯Ø§Ù… ØªØºÛŒÛŒØ± ØªÙ…
document.getElementById('theme').addEventListener('change', function(){
  setTimeout(updateFooterTheme, 50);
});

// Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
window.addEventListener('load', updateFooterTheme);
</script>
</body>
</html>
